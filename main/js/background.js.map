{"version":3,"sources":["webpack:///background.js","webpack:///webpack/bootstrap 799b2ffadf3bf20f68d7?649c***","webpack:///./src/background.js"],"names":["modules","__webpack_require__","moduleId","installedModules","exports","module","i","l","call","m","c","value","d","name","getter","o","Object","defineProperty","configurable","enumerable","get","n","__esModule","object","property","prototype","hasOwnProperty","p","s","8","sendFetchDataToContentScript","data","cmd","chrome","tabs","query","forEach","tab","index","url","indexOf","sendMessage","id","res","uuid","response","bgUtil","ver","removeMenuItem","contextMenus","remove","createMenuItem","itemId","documentUrlPatterns","navigator","userAgent","toLocaleLowerCase","match","create","title","icon","path","onclick","active","currentWindow","currentTab","onClicked","addListener","a","b","menuItemId","notify","params","notifications","type","iconUrl","message","setBadgeText","text","browserAction","setStorage","storage","sync","set","runtime","onMessage","request","sender","sendResponse","JSON","stringify","href","content","html","$","ajax","timeout","async","dataType","success","responseText","error","desc","msg","xhr","XMLHttpRequest","open","responseType","onreadystatechange","readyState","status","blob","file","FileReader","onload","result","readAsDataURL","dist","send","dlData","downloads","download","filename","fileName","conflictAction","saveAs","click","e","console","log","views","extension","getViews","length","alert","document"],"mappings":"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","file":"background.js","sourcesContent":["/******/ (function(modules) { // webpackBootstrap\n/******/ \t// The module cache\n/******/ \tvar installedModules = {};\n/******/\n/******/ \t// The require function\n/******/ \tfunction __webpack_require__(moduleId) {\n/******/\n/******/ \t\t// Check if module is in cache\n/******/ \t\tif(installedModules[moduleId]) {\n/******/ \t\t\treturn installedModules[moduleId].exports;\n/******/ \t\t}\n/******/ \t\t// Create a new module (and put it into the cache)\n/******/ \t\tvar module = installedModules[moduleId] = {\n/******/ \t\t\ti: moduleId,\n/******/ \t\t\tl: false,\n/******/ \t\t\texports: {}\n/******/ \t\t};\n/******/\n/******/ \t\t// Execute the module function\n/******/ \t\tmodules[moduleId].call(module.exports, module, module.exports, __webpack_require__);\n/******/\n/******/ \t\t// Flag the module as loaded\n/******/ \t\tmodule.l = true;\n/******/\n/******/ \t\t// Return the exports of the module\n/******/ \t\treturn module.exports;\n/******/ \t}\n/******/\n/******/\n/******/ \t// expose the modules object (__webpack_modules__)\n/******/ \t__webpack_require__.m = modules;\n/******/\n/******/ \t// expose the module cache\n/******/ \t__webpack_require__.c = installedModules;\n/******/\n/******/ \t// identity function for calling harmony imports with the correct context\n/******/ \t__webpack_require__.i = function(value) { return value; };\n/******/\n/******/ \t// define getter function for harmony exports\n/******/ \t__webpack_require__.d = function(exports, name, getter) {\n/******/ \t\tif(!__webpack_require__.o(exports, name)) {\n/******/ \t\t\tObject.defineProperty(exports, name, {\n/******/ \t\t\t\tconfigurable: false,\n/******/ \t\t\t\tenumerable: true,\n/******/ \t\t\t\tget: getter\n/******/ \t\t\t});\n/******/ \t\t}\n/******/ \t};\n/******/\n/******/ \t// getDefaultExport function for compatibility with non-harmony modules\n/******/ \t__webpack_require__.n = function(module) {\n/******/ \t\tvar getter = module && module.__esModule ?\n/******/ \t\t\tfunction getDefault() { return module['default']; } :\n/******/ \t\t\tfunction getModuleExports() { return module; };\n/******/ \t\t__webpack_require__.d(getter, 'a', getter);\n/******/ \t\treturn getter;\n/******/ \t};\n/******/\n/******/ \t// Object.prototype.hasOwnProperty.call\n/******/ \t__webpack_require__.o = function(object, property) { return Object.prototype.hasOwnProperty.call(object, property); };\n/******/\n/******/ \t// __webpack_public_path__\n/******/ \t__webpack_require__.p = \"/main/js/\";\n/******/\n/******/ \t// Load entry module and return exports\n/******/ \treturn __webpack_require__(__webpack_require__.s = 8);\n/******/ })\n/************************************************************************/\n/******/ ({\n\n/***/ 8:\n/***/ (function(module, exports) {\n\n//-------------------- 右键菜单演示 ------------------------//\n\nvar bgUtil = {\n\tver: '1.0.0',\n\t// 删除右键菜单（未使用）\n\tremoveMenuItem: function () {\n\t\tchrome.contextMenus.remove('wb-context', function () {});\n\t},\n\tcreateMenuItem: function () {\n\t\tvar itemId = 'wb-context-add-to-copy-list';\n\t\t// 只在下列网站显示右键菜单\n\t\tvar documentUrlPatterns = ['https://detail.tmall.com/*', 'https://item.taobao.com/*', 'https://detail.1688.com/*', 'https://h5.m.taobao.com/*', 'https://detail.m.tmall.com/*', 'https://m.1688.com/*'];\n\n\t\tvar ua = navigator.userAgent.toLocaleLowerCase();\n\t\t// 搜狗浏览器没 默认icon，要手动添加，而稍旧的版本不支持onclick属性\n\t\tif (ua.match(/metasr/) != null) {\n\t\t\tchrome.contextMenus.create({\n\t\t\t\ttitle: \"添加到宝贝复制队列\",\n\t\t\t\tid: itemId,\n\t\t\t\ticon: { path: 'img/icon.png' },\n\t\t\t\t// 右键菜单只在下列网站可用\n\t\t\t\tdocumentUrlPatterns: documentUrlPatterns,\n\t\t\t\tonclick: function () {\n\t\t\t\t\tchrome.tabs.query({ active: true, currentWindow: true }, function (currentTab) {\n\t\t\t\t\t\t// 当前页面的url\n\t\t\t\t\t\t// 向当前页面的content-script 发送获取html内容的请求\n\t\t\t\t\t\tchrome.tabs.sendMessage(currentTab[0].id, { cmd: \"fetchHtmlAndDesc\" }, function (response) {\n\t\t\t\t\t\t\tresponse();\n\t\t\t\t\t\t});\n\t\t\t\t\t});\n\t\t\t\t\treturn;\n\t\t\t\t}\n\t\t\t});\n\t\t\tchrome.contextMenus.onClicked.addListener(function (a, b) {\n\t\t\t\tif (a.menuItemId == itemId) {\n\t\t\t\t\tchrome.tabs.query({ active: true, currentWindow: true }, function (currentTab) {\n\t\t\t\t\t\t// 当前页面的url\n\t\t\t\t\t\t// 向当前页面的content-script 发送获取html内容的请求\n\t\t\t\t\t\tchrome.tabs.sendMessage(currentTab[0].id, { cmd: \"fetchHtmlAndDesc\" }, function (response) {\n\t\t\t\t\t\t\tresponse();\n\t\t\t\t\t\t});\n\t\t\t\t\t});\n\t\t\t\t}\n\t\t\t});\n\t\t} else {\n\t\t\tchrome.contextMenus.create({\n\t\t\t\ttitle: \"添加到宝贝复制队列\",\n\t\t\t\tid: itemId,\n\t\t\t\t// 右键菜单只在下列网站可用\n\t\t\t\tdocumentUrlPatterns: documentUrlPatterns,\n\t\t\t\tonclick: function () {\n\t\t\t\t\tchrome.tabs.query({ active: true, currentWindow: true }, function (currentTab) {\n\t\t\t\t\t\t// 当前页面的url\n\t\t\t\t\t\t// 向当前页面的content-script 发送获取html内容的请求\n\t\t\t\t\t\tchrome.tabs.sendMessage(currentTab[0].id, { cmd: \"fetchHtmlAndDesc\" }, function (response) {\n\t\t\t\t\t\t\tresponse();\n\t\t\t\t\t\t});\n\t\t\t\t\t});\n\t\t\t\t\treturn;\n\t\t\t\t}\n\t\t\t});\n\t\t}\n\t},\n\t// 电脑右下角通知\n\tnotify: function (params) {\n\t\tchrome.notifications.create(null, {\n\t\t\ttype: params.type || 'basic',\n\t\t\ticonUrl: params.iconUrl || 'img/icon.png',\n\t\t\ttitle: params.title || '这是标题',\n\t\t\tmessage: params.message || ''\n\t\t});\n\t},\n\tsetBadgeText: function (text) {\n\t\tchrome.browserAction.setBadgeText({ text: text });\n\t},\n\tsetStorage: function (params) {\n\t\tchrome.storage.sync.set(params);\n\t}\n};\n\nfunction backgroundInit() {\n\n\tbgUtil.createMenuItem();\n\tbgUtil.setStorage({ ver: bgUtil.ver });\n\t// 能够检测版本的url\n\t/* var verUrl = 'http://wdb.wonbao.com/goodsCopyVer.json';\r\n $.ajax({\r\n \ttype: \"GET\",\r\n \turl: verUrl,\r\n \tasync: false,\r\n \tdata: {},\r\n \tdataType: \"json\",\r\n \tsuccess: function(data){\r\n \t\tif(data.ver != bgUtil.ver) {\r\n \t\t\tbgUtil.setBadgeText('new');\r\n \t\t}\r\n \t},\r\n \terror: function(data) {\r\n \t}\r\n });\r\n */\n}\nbackgroundInit();\n//-------------------- badge演示 ------------------------//\nvar contentMap = {};\n// 监听来自content-script的消息\nchrome.runtime.onMessage.addListener(function (request, sender, sendResponse) {\n\t// 只作测试用\n\tif (request.cmd == 'default') {\n\t\t// console.log('收到来自content-script的消息：');\n\t\t// console.log(request, sender, sendResponse);\n\t\tsendResponse('我是后台，我已收到你的消息：' + JSON.stringify(request));\n\t} /*else if(request.cmd == 'receiveContent') { // 不再使用了\r\n   var id = request.id;\r\n   if (!id) {\r\n   contentMap[id] = '';\r\n   }\r\n   contentMap[id] = ((contentMap[id] || '')+ (request.content || ''));\r\n   \t$.ajax({\r\n   type: \"POST\",\r\n   url: \"http://localhost:3000/receive\",\r\n   data: {content: request.content, id: id},\r\n   dataType: \"json\",\r\n   success: function(data){\r\n   \r\n   },\r\n   error: function(data) {\r\n   }\r\n   });\r\n   } */\n\telse if (request.cmd == 'notifyIframeHtmlUsefull') {\n\t\t\t// 告知当前iframe 页面是否有内容\n\t\t\tchrome.tabs.query({}, function (tabs) {\n\t\t\t\ttabs.forEach(function (tab, index) {\n\t\t\t\t\tif (tab.url.indexOf('localhost') > -1 || tab.url.indexOf('wonbao') > -1 || tab.url.indexOf('file:') > -1 || tab.url.indexOf('192.168') > -1 || tab.url.indexOf('yangkeduo.com/goods') > -1) {\n\t\t\t\t\t\tchrome.tabs.sendMessage(tabs[index].id, {\n\t\t\t\t\t\t\tindex: index,\n\t\t\t\t\t\t\tcmd: \"notifyIframeUsefull\",\n\t\t\t\t\t\t\thref: request.href\n\t\t\t\t\t\t}, function (response) {});\n\t\t\t\t\t}\n\t\t\t\t});\n\t\t\t});\n\t\t\tsendResponse();\n\t\t} else if (request.cmd == 'notifyIframeCopyResult') {\n\t\t\tchrome.tabs.query({}, function (tabs) {\n\t\t\t\ttabs.forEach(function (tab, index) {\n\t\t\t\t\tif (tab.url.indexOf('localhost') > -1 || tab.url.indexOf('wonbao') > -1 || tab.url.indexOf('file:') > -1 || tab.url.indexOf('192.168') > -1 || tab.url.indexOf('yangkeduo.com/goods') > -1) {\n\t\t\t\t\t\tchrome.tabs.sendMessage(tabs[index].id, {\n\t\t\t\t\t\t\tindex: index,\n\t\t\t\t\t\t\tcmd: \"reveiverIframeHtml\",\n\t\t\t\t\t\t\tcontent: request.content,\n\t\t\t\t\t\t\thref: request.href,\n\t\t\t\t\t\t\thtml: request.html\n\t\t\t\t\t\t}, function (response) {});\n\t\t\t\t\t}\n\t\t\t\t});\n\t\t\t});\n\t\t\tsendResponse();\n\t\t} else if (request.cmd == 'openTab') {\n\t\t\t// 打开新tab页面\n\t\t\tvar params = request.params;\n\t\t\tchrome.tabs.create({ url: params.url });\n\t\t} else if (request.cmd == 'notify') {\n\t\t\tvar params = request.params;\n\t\t\tchrome.notifications.create(null, {\n\t\t\t\ttype: params.type || 'basic',\n\t\t\t\ticonUrl: params.iconUrl || 'img/icon.png',\n\t\t\t\ttitle: params.title || '这是标题',\n\t\t\t\tmessage: params.message || ''\n\t\t\t});\n\t\t\tsendResponse();\n\t\t} else if (request.cmd == 'fetchData') {\n\t\t\t// 跨域获取数据\n\t\t\t$.ajax({\n\t\t\t\ttype: \"GET\",\n\t\t\t\turl: request.url,\n\t\t\t\ttimeout: request.timeout,\n\t\t\t\tasync: false,\n\t\t\t\tdata: {},\n\t\t\t\tdataType: \"json\",\n\t\t\t\tsuccess: function (data) {\n\t\t\t\t\tvar dist = {\n\t\t\t\t\t\turl: request.url,\n\t\t\t\t\t\tres: data.responseText,\n\t\t\t\t\t\tuuid: request.uuid\n\t\t\t\t\t};\n\t\t\t\t\tsendFetchDataToContentScript(dist, \"reveiveFetchData\");\n\t\t\t\t\t/* chrome.notifications.create(null, {\r\n     \ttype: params.type || 'basic',\r\n     \ticonUrl: params.iconUrl || 'img/icon.png',\r\n     \ttitle: params.title || '这是标题' + 'success',\r\n     \tmessage: params.message || ''\r\n     }); */\n\n\t\t\t\t\t// sendResponse((dist));\n\t\t\t\t},\n\t\t\t\terror: function (data) {\n\t\t\t\t\tvar dist = {\n\t\t\t\t\t\turl: request.url,\n\t\t\t\t\t\tres: data.responseText,\n\t\t\t\t\t\tuuid: request.uuid\n\t\t\t\t\t};\n\t\t\t\t\tsendFetchDataToContentScript(dist, \"reveiveFetchData\");\n\t\t\t\t\t/* chrome.notifications.create(null, {\r\n     \ttype: params.type || 'basic',\r\n     \ticonUrl: params.iconUrl || 'img/icon.png',\r\n     \ttitle: params.title || '这是标题' + 'error',\r\n     \tmessage: params.message || ''\r\n     }); */\n\t\t\t\t\t// sendResponse(JSON.stringify(dist));\n\t\t\t\t}\n\t\t\t});\n\t\t\tsendResponse();\n\t\t} else if (request.cmd == 'notifyReceiveTaskFetchHtmlAndDesc') {\n\t\t\t// 右键点击后获取的数据\n\t\t\tchrome.tabs.query({}, function (tabs) {\n\t\t\t\ttabs.forEach(function (tab, index) {\n\t\t\t\t\tif (tab.url.indexOf('localhost') > -1 || tab.url.indexOf('wonbao') > -1 || tab.url.indexOf('file:') > -1 || tab.url.indexOf('192.168') > -1) {\n\t\t\t\t\t\tchrome.tabs.sendMessage(tabs[index].id, {\n\t\t\t\t\t\t\tcmd: \"receiveNewQueue\",\n\t\t\t\t\t\t\turl: request.url,\n\t\t\t\t\t\t\thtml: request.html,\n\t\t\t\t\t\t\tdesc: request.desc,\n\t\t\t\t\t\t\tmsg: request.msg\n\t\t\t\t\t\t}, function (response) {});\n\t\t\t\t\t}\n\t\t\t\t});\n\t\t\t});\n\t\t\tsendResponse();\n\t\t} else if (request.cmd == 'httpRequest') {\n\t\t\tvar xhr = new XMLHttpRequest();\n\t\t\txhr.open(\"GET\", request.url, true);\n\t\t\txhr.responseType = request.responseType || 'blob'; //\"arraybuffer\";\n\t\t\txhr.onreadystatechange = function () {\n\t\t\t\tif (xhr.readyState == 4) {\n\t\t\t\t\tif (xhr.status == 200 || xhr.status == 304) {\n\t\t\t\t\t\tvar blob = xhr.response;\n\n\t\t\t\t\t\tif (blob) {\n\t\t\t\t\t\t\tvar file = new FileReader();\n\t\t\t\t\t\t\tfile.onload = function () {\n\t\t\t\t\t\t\t\t// callback(blob);\n\t\t\t\t\t\t\t\tvar dist = {\n\t\t\t\t\t\t\t\t\turl: request.url,\n\t\t\t\t\t\t\t\t\tres: file.result,\n\t\t\t\t\t\t\t\t\tuuid: request.uuid,\n\t\t\t\t\t\t\t\t\tsuccess: true\n\t\t\t\t\t\t\t\t};\n\t\t\t\t\t\t\t\tsendFetchDataToContentScript(dist, 'receiveHttpRequest');\n\t\t\t\t\t\t\t};\n\t\t\t\t\t\t\tfile.readAsDataURL(blob);\n\t\t\t\t\t\t}\n\t\t\t\t\t} else {\n\t\t\t\t\t\tvar dist = {\n\t\t\t\t\t\t\turl: request.url,\n\t\t\t\t\t\t\tres: '',\n\t\t\t\t\t\t\tuuid: request.uuid,\n\t\t\t\t\t\t\tsuccess: false\n\t\t\t\t\t\t};\n\t\t\t\t\t\tsendFetchDataToContentScript(dist, 'receiveHttpRequest');\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t};\n\t\t\txhr.send(null);\n\t\t\tsendResponse();\n\t\t} else if (request.cmd == 'sendDownload') {\n\t\t\t// 下载文件\n\t\t\tvar dlData = [];\n\t\t\tchrome.downloads.download({\n\t\t\t\turl: request.url,\n\t\t\t\tfilename: request.fileName,\n\t\t\t\tconflictAction: 'overwrite',\n\t\t\t\tsaveAs: false\n\t\t\t}, function (id) {\n\t\t\t\t// id 是 Chrome 新建立的下载任务的 id\n\t\t\t\tdlData[id] = {\n\t\t\t\t\turl: request.url,\n\t\t\t\t\tid: request.id,\n\t\t\t\t\tuuid: false\n\t\t\t\t};\n\t\t\t});\n\t\t}\n});\n\n// 将跨域获取的数据传回到content-script, content-script 再传到宿主页面 \nfunction sendFetchDataToContentScript(data, cmd) {\n\tchrome.tabs.query({}, function (tabs) {\n\t\ttabs.forEach(function (tab, index) {\n\t\t\tif (tab.url.indexOf('danbooru') > -1 || tab.url.indexOf('yande.re') > -1 || tab.url.indexOf('localhost') > -1 || tab.url.indexOf('wonbao') > -1 || tab.url.indexOf('file:') > -1 || tab.url.indexOf('192.168') > -1) {\n\t\t\t\tchrome.tabs.sendMessage(tabs[index].id, {\n\t\t\t\t\tindex: index,\n\t\t\t\t\tcmd: cmd,\n\t\t\t\t\turl: data.url,\n\t\t\t\t\tres: data.res,\n\t\t\t\t\tuuid: data.uuid\n\t\t\t\t}, function (response) {});\n\t\t\t}\n\t\t});\n\t});\n}\n\n$('#test_cors').click(function (e) {\n\t/* $.get('https://www.baidu.com', function(html){\r\n \tconsole.log( html);\r\n \talert('跨域调用成功！');\r\n }); */\n\t// var url = 'https://detail.1688.com/offer/577545270423.html';\n\tvar url = 'https://ai.taobao.com/search/index.htm?source_id=search&key=%E5%90%95';\n\t$.ajax({\n\t\ttype: \"GET\",\n\t\turl: url,\n\t\ttimeout: 10000000,\n\t\tasync: false,\n\t\tdata: {},\n\t\tdataType: \"json\",\n\t\tsuccess: function (data) {\n\t\t\tconsole.log('success');\n\t\t\tconsole.log(data);\n\t\t},\n\t\terror: function (data) {\n\t\t\tconsole.log('error');\n\t\t\tconsole.log(data);\n\t\t}\n\t});\n});\n\n$('#get_popup_title').click(function (e) {\n\tvar views = chrome.extension.getViews({ type: 'popup' });\n\tif (views.length > 0) {\n\t\talert(views[0].document.title);\n\t} else {\n\t\talert('popup未打开！');\n\t}\n});\n\n// 获取当前选项卡ID\nfunction getCurrentTabId(callback) {\n\tchrome.tabs.query({ active: true, currentWindow: true }, function (tabs) {\n\t\tif (callback) callback(tabs.length ? tabs[0].id : null);\n\t});\n}\n\n// 当前标签打开某个链接\nfunction openUrlCurrentTab(url) {\n\tgetCurrentTabId(function (tabId) {\n\t\tchrome.tabs.update(tabId, { url: url });\n\t});\n}\n\n// 新标签打开某个链接\nfunction openUrlNewTab(url) {\n\tchrome.tabs.create({ url: url });\n}\n\n// 预留一个方法给popup调用\nfunction testBackground() {\n\talert('你好，我是background！');\n}\n\n/* \r\n// 是否显示图片\r\nvar showImage;\r\nchrome.storage.sync.get({showImage: true}, function(items) {\r\n\tshowImage = items.showImage;\r\n});\r\n\r\n// web请求监听，最后一个参数表示阻塞式，需单独声明权限：webRequestBlocking\r\nchrome.webRequest.onBeforeRequest.addListener(function (details) {\r\n\t// cancel 表示取消本次请求\r\n\tif(!showImage && details.type == 'image') return {cancel: true};\r\n\t// 简单的音视频检测\r\n\t// 大部分网站视频的type并不是media，且视频做了防下载处理，所以这里仅仅是为了演示效果，无实际意义\r\n\tif(details.type == 'media') {\r\n\t\tchrome.notifications.create(null, {\r\n\t\t\ttype: 'basic',\r\n\t\t\ticonUrl: 'img/icon.png',\r\n\t\t\ttitle: '检测到音视频',\r\n\t\t\tmessage: '音视频地址：' + details.url,\r\n\t\t});\r\n\t}\r\n}, {urls: [\"<all_urls>\"]}, [\"blocking\"]); */\n\n/***/ })\n\n/******/ });\n\n\n// WEBPACK FOOTER //\n// background.js"," \t// The module cache\n \tvar installedModules = {};\n\n \t// The require function\n \tfunction __webpack_require__(moduleId) {\n\n \t\t// Check if module is in cache\n \t\tif(installedModules[moduleId]) {\n \t\t\treturn installedModules[moduleId].exports;\n \t\t}\n \t\t// Create a new module (and put it into the cache)\n \t\tvar module = installedModules[moduleId] = {\n \t\t\ti: moduleId,\n \t\t\tl: false,\n \t\t\texports: {}\n \t\t};\n\n \t\t// Execute the module function\n \t\tmodules[moduleId].call(module.exports, module, module.exports, __webpack_require__);\n\n \t\t// Flag the module as loaded\n \t\tmodule.l = true;\n\n \t\t// Return the exports of the module\n \t\treturn module.exports;\n \t}\n\n\n \t// expose the modules object (__webpack_modules__)\n \t__webpack_require__.m = modules;\n\n \t// expose the module cache\n \t__webpack_require__.c = installedModules;\n\n \t// identity function for calling harmony imports with the correct context\n \t__webpack_require__.i = function(value) { return value; };\n\n \t// define getter function for harmony exports\n \t__webpack_require__.d = function(exports, name, getter) {\n \t\tif(!__webpack_require__.o(exports, name)) {\n \t\t\tObject.defineProperty(exports, name, {\n \t\t\t\tconfigurable: false,\n \t\t\t\tenumerable: true,\n \t\t\t\tget: getter\n \t\t\t});\n \t\t}\n \t};\n\n \t// getDefaultExport function for compatibility with non-harmony modules\n \t__webpack_require__.n = function(module) {\n \t\tvar getter = module && module.__esModule ?\n \t\t\tfunction getDefault() { return module['default']; } :\n \t\t\tfunction getModuleExports() { return module; };\n \t\t__webpack_require__.d(getter, 'a', getter);\n \t\treturn getter;\n \t};\n\n \t// Object.prototype.hasOwnProperty.call\n \t__webpack_require__.o = function(object, property) { return Object.prototype.hasOwnProperty.call(object, property); };\n\n \t// __webpack_public_path__\n \t__webpack_require__.p = \"/main/js/\";\n\n \t// Load entry module and return exports\n \treturn __webpack_require__(__webpack_require__.s = 8);\n\n\n\n// WEBPACK FOOTER //\n// webpack/bootstrap 799b2ffadf3bf20f68d7","//-------------------- 右键菜单演示 ------------------------//\r\n\r\nvar bgUtil = {\r\n\tver: '1.0.0',\r\n\t// 删除右键菜单（未使用）\r\n\tremoveMenuItem: function () {\r\n\t\tchrome.contextMenus.remove('wb-context', function() {\r\n\t\t})\r\n\t},\r\n\tcreateMenuItem: function () {\r\n\t\tvar itemId = 'wb-context-add-to-copy-list';\r\n\t\t// 只在下列网站显示右键菜单\r\n\t\tvar documentUrlPatterns = [\r\n\t\t\t'https://detail.tmall.com/*',\r\n\t\t\t'https://item.taobao.com/*',\r\n\t\t\t'https://detail.1688.com/*',\r\n\t\t\t'https://h5.m.taobao.com/*',\r\n\t\t\t'https://detail.m.tmall.com/*',\r\n\t\t\t'https://m.1688.com/*'\r\n\t\t];\r\n\r\n\t\tvar ua = navigator.userAgent.toLocaleLowerCase();\r\n\t\t// 搜狗浏览器没 默认icon，要手动添加，而稍旧的版本不支持onclick属性\r\n\t\tif(ua.match(/metasr/) != null){\r\n\t\t\tchrome.contextMenus.create({\r\n\t\t\t\ttitle: \"添加到宝贝复制队列\",\r\n\t\t\t\tid: itemId,\r\n\t\t\t\ticon: {path: 'img/icon.png'},\r\n\t\t\t\t// 右键菜单只在下列网站可用\r\n\t\t\t\tdocumentUrlPatterns: documentUrlPatterns,\r\n\t\t\t\tonclick: function(){\r\n\t\t\t\t\tchrome.tabs.query({active: true, currentWindow: true}, function(currentTab){\r\n\t\t\t\t\t\t// 当前页面的url\r\n\t\t\t\t\t\t// 向当前页面的content-script 发送获取html内容的请求\r\n\t\t\t\t\t\tchrome.tabs.sendMessage(currentTab[0].id, {cmd: \"fetchHtmlAndDesc\"}, function(response) {\r\n\t\t\t\t\t\t\tresponse();\r\n\t\t\t\t\t\t})\r\n\t\t\t\t\t})\r\n\t\t\t\t\treturn;\r\n\t\t\t\t}\r\n\t\t\t});\r\n\t\t\tchrome.contextMenus.onClicked.addListener(function(a, b) {\r\n\t\t\t\tif(a.menuItemId == itemId) {\r\n\t\t\t\t\tchrome.tabs.query({active: true, currentWindow: true}, function(currentTab){\r\n\t\t\t\t\t\t// 当前页面的url\r\n\t\t\t\t\t\t// 向当前页面的content-script 发送获取html内容的请求\r\n\t\t\t\t\t\tchrome.tabs.sendMessage(currentTab[0].id, {cmd: \"fetchHtmlAndDesc\"}, function(response) {\r\n\t\t\t\t\t\t\tresponse();\r\n\t\t\t\t\t\t})\r\n\t\t\t\t\t})\r\n\t\t\t\t}\r\n\t\t\t})\r\n\t\t} else {\r\n\t\t\t\tchrome.contextMenus.create({\r\n\t\t\t\t\ttitle: \"添加到宝贝复制队列\",\r\n\t\t\t\t\tid: itemId,\r\n\t\t\t\t\t// 右键菜单只在下列网站可用\r\n\t\t\t\t\tdocumentUrlPatterns: documentUrlPatterns,\r\n\t\t\t\t\tonclick: function(){\r\n\t\t\t\t\t\tchrome.tabs.query({active: true, currentWindow: true}, function(currentTab){\r\n\t\t\t\t\t\t\t// 当前页面的url\r\n\t\t\t\t\t\t\t// 向当前页面的content-script 发送获取html内容的请求\r\n\t\t\t\t\t\t\tchrome.tabs.sendMessage(currentTab[0].id, {cmd: \"fetchHtmlAndDesc\"}, function(response) {\r\n\t\t\t\t\t\t\t\tresponse();\r\n\t\t\t\t\t\t\t})\r\n\t\t\t\t\t\t})\r\n\t\t\t\t\t\treturn;\r\n\t\t\t\t\t}\r\n\t\t\t\t});\r\n\t\t}\r\n\t\t\r\n\t},\r\n\t// 电脑右下角通知\r\n\tnotify: function (params) {\r\n\t\tchrome.notifications.create(null, {\r\n\t\t\ttype: params.type || 'basic',\r\n\t\t\ticonUrl: params.iconUrl || 'img/icon.png',\r\n\t\t\ttitle: params.title || '这是标题',\r\n\t\t\tmessage: params.message || ''\r\n\t\t});\r\n\t},\r\n\tsetBadgeText: function (text) {\r\n\t\tchrome.browserAction.setBadgeText({text: text});\r\n\t},\r\n\tsetStorage: function(params) {\r\n\t\tchrome.storage.sync.set(params);\r\n\t}\r\n}\r\n\r\n\r\nfunction backgroundInit() {\r\n\t\r\n\tbgUtil.createMenuItem();\r\n\tbgUtil.setStorage({ver: bgUtil.ver});\r\n\t// 能够检测版本的url\r\n\t/* var verUrl = 'http://wdb.wonbao.com/goodsCopyVer.json';\r\n\t$.ajax({\r\n\t\ttype: \"GET\",\r\n\t\turl: verUrl,\r\n\t\tasync: false,\r\n\t\tdata: {},\r\n\t\tdataType: \"json\",\r\n\t\tsuccess: function(data){\r\n\t\t\tif(data.ver != bgUtil.ver) {\r\n\t\t\t\tbgUtil.setBadgeText('new');\r\n\t\t\t}\r\n\t\t},\r\n\t\terror: function(data) {\r\n\t\t}\r\n\t});\r\n\t*/\r\n}\r\nbackgroundInit();\r\n//-------------------- badge演示 ------------------------//\r\nvar contentMap = {\r\n}\r\n// 监听来自content-script的消息\r\nchrome.runtime.onMessage.addListener(function(request, sender, sendResponse)\r\n{\t\r\n\t// 只作测试用\r\n\tif(request.cmd =='default') {\r\n\t\t// console.log('收到来自content-script的消息：');\r\n\t\t// console.log(request, sender, sendResponse);\r\n\t\tsendResponse('我是后台，我已收到你的消息：' + JSON.stringify(request));\r\n\t} /*else if(request.cmd == 'receiveContent') { // 不再使用了\r\n\t\tvar id = request.id;\r\n\t\tif (!id) {\r\n\t\t\tcontentMap[id] = '';\r\n\t\t}\r\n\t\tcontentMap[id] = ((contentMap[id] || '')+ (request.content || ''));\r\n\r\n\t\t$.ajax({\r\n\t\t\ttype: \"POST\",\r\n\t\t\turl: \"http://localhost:3000/receive\",\r\n\t\t\tdata: {content: request.content, id: id},\r\n\t\t\tdataType: \"json\",\r\n\t\t\tsuccess: function(data){\r\n\t\t\t\r\n\t\t\t},\r\n\t\t\terror: function(data) {\r\n\t\t\t}\r\n\t\t});\r\n\t} */\r\n\telse if (request.cmd == 'notifyIframeHtmlUsefull') { // 告知当前iframe 页面是否有内容\r\n\t\tchrome.tabs.query({}, function(tabs){\r\n\t\t\ttabs.forEach(function(tab, index) {\r\n\t\t\t\tif(tab.url.indexOf('localhost') > -1 || tab.url.indexOf('wonbao') > -1 || tab.url.indexOf('file:')>-1 || tab.url.indexOf('192.168') > -1 || tab.url.indexOf('yangkeduo.com/goods') > -1) {\r\n\t\t\t\t\tchrome.tabs.sendMessage(\r\n\t\t\t\t\t\ttabs[index].id, \r\n\t\t\t\t\t\t{\r\n\t\t\t\t\t\t\tindex: index,\r\n\t\t\t\t\t\t\tcmd: \"notifyIframeUsefull\",\r\n\t\t\t\t\t\t\thref: request.href,\r\n\t\t\t\t\t\t},\r\n\t\t\t\t\t\tfunction(response) {\r\n\t\t\t\t\t})\r\n\t\t\t\t}\r\n\t\t\t})\r\n\t\t})\r\n\t\tsendResponse();\r\n\t}\r\n\telse if(request.cmd == 'notifyIframeCopyResult') {\r\n\t\tchrome.tabs.query({}, function(tabs){\r\n\t\t\ttabs.forEach(function(tab, index) {\r\n\t\t\t\tif(tab.url.indexOf('localhost') > -1 || tab.url.indexOf('wonbao') > -1 || tab.url.indexOf('file:')>-1 || tab.url.indexOf('192.168') > -1 || tab.url.indexOf('yangkeduo.com/goods') > -1) {\r\n\t\t\t\t\tchrome.tabs.sendMessage(\r\n\t\t\t\t\t\ttabs[index].id, \r\n\t\t\t\t\t\t{\r\n\t\t\t\t\t\t\tindex: index,\r\n\t\t\t\t\t\t\tcmd: \"reveiverIframeHtml\",\r\n\t\t\t\t\t\t\tcontent: request.content,\r\n\t\t\t\t\t\t\thref: request.href,\r\n\t\t\t\t\t\t\thtml: request.html\r\n\t\t\t\t\t\t},\r\n\t\t\t\t\t\tfunction(response) {\r\n\t\t\t\t\t})\r\n\t\t\t\t}\r\n\t\t\t})\r\n\t\t})\r\n\t\tsendResponse();\r\n\t} else if (request.cmd == 'openTab') { // 打开新tab页面\r\n\t\tvar params = request.params;\r\n\t\tchrome.tabs.create({url: params.url});\r\n\t} else if (request.cmd == 'notify') {\r\n\t\tvar params = request.params;\r\n\t\tchrome.notifications.create(null, {\r\n\t\t\ttype: params.type || 'basic',\r\n\t\t\ticonUrl: params.iconUrl || 'img/icon.png',\r\n\t\t\ttitle: params.title || '这是标题',\r\n\t\t\tmessage: params.message || ''\r\n\t\t});\r\n\t\tsendResponse();\r\n\t} else if (request.cmd == 'fetchData') { // 跨域获取数据\r\n\t\t$.ajax({\r\n\t\t\ttype: \"GET\",\r\n\t\t\turl: request.url,\r\n\t\t\ttimeout: request.timeout,\r\n\t\t\tasync: false,\r\n\t\t\tdata: {},\r\n\t\t\tdataType: \"json\",\r\n\t\t\tsuccess: function(data){\r\n\t\t\t\tvar dist = {\r\n\t\t\t\t\turl: request.url,\r\n\t\t\t\t\tres: data.responseText,\r\n\t\t\t\t\tuuid: request.uuid\r\n\t\t\t\t}\r\n\t\t\t\tsendFetchDataToContentScript(dist, \"reveiveFetchData\");\r\n\t\t\t\t/* chrome.notifications.create(null, {\r\n\t\t\t\t\ttype: params.type || 'basic',\r\n\t\t\t\t\ticonUrl: params.iconUrl || 'img/icon.png',\r\n\t\t\t\t\ttitle: params.title || '这是标题' + 'success',\r\n\t\t\t\t\tmessage: params.message || ''\r\n\t\t\t\t}); */\r\n\r\n\t\t\t\t// sendResponse((dist));\r\n\t\t\t},\r\n\t\t\terror: function(data) {\r\n\t\t\t\tvar dist = {\r\n\t\t\t\t\turl: request.url,\r\n\t\t\t\t\tres: data.responseText,\r\n\t\t\t\t\tuuid: request.uuid\r\n\t\t\t\t}\r\n\t\t\t\tsendFetchDataToContentScript(dist, \"reveiveFetchData\");\r\n\t\t\t\t/* chrome.notifications.create(null, {\r\n\t\t\t\t\ttype: params.type || 'basic',\r\n\t\t\t\t\ticonUrl: params.iconUrl || 'img/icon.png',\r\n\t\t\t\t\ttitle: params.title || '这是标题' + 'error',\r\n\t\t\t\t\tmessage: params.message || ''\r\n\t\t\t\t}); */\r\n\t\t\t\t// sendResponse(JSON.stringify(dist));\r\n\t\t\t}\r\n\t\t});\r\n\t\tsendResponse();\r\n\t} else if (request.cmd == 'notifyReceiveTaskFetchHtmlAndDesc') { // 右键点击后获取的数据\r\n\t\tchrome.tabs.query({}, function(tabs){\r\n\t\t\ttabs.forEach(function(tab, index) {\r\n\t\t\t\tif(tab.url.indexOf('localhost') > -1 || tab.url.indexOf('wonbao') > -1 || tab.url.indexOf('file:') > -1 || tab.url.indexOf('192.168') > -1) {\r\n\t\t\t\t\tchrome.tabs.sendMessage(tabs[index].id, {\r\n\t\t\t\t\t\t\tcmd: \"receiveNewQueue\",\r\n\t\t\t\t\t\t\turl: request.url,\r\n\t\t\t\t\t\t\thtml: request.html,\r\n\t\t\t\t\t\t\tdesc: request.desc,\r\n\t\t\t\t\t\t\tmsg: request.msg,\r\n\t\t\t\t\t\t}, function(response) {\r\n\t\t\t\t\t})\r\n\t\t\t\t}\r\n\t\t\t})\r\n\t\t})\r\n\t\tsendResponse();\r\n\t} else if (request.cmd == 'httpRequest') {\r\n\t\tvar xhr = new XMLHttpRequest();\r\n\t\txhr.open(\"GET\", request.url, true);\r\n\t\txhr.responseType = request.responseType || 'blob';//\"arraybuffer\";\r\n\t\txhr.onreadystatechange = function() {\r\n\t\t\tif (xhr.readyState == 4) {\r\n\t\t\t\tif (xhr.status == 200 || xhr.status == 304) {\r\n\t\t\t\t\tvar blob = xhr.response;\r\n\t\t\t\t\t\r\n\t\t\t\t\tif(blob) {\r\n\t\t\t\t\t\tvar file = new FileReader();\r\n\t\t\t\t\t\tfile.onload =function() {\r\n\t\t\t\t\t\t\t// callback(blob);\r\n\t\t\t\t\t\t\tvar dist = {\r\n\t\t\t\t\t\t\t\turl: request.url,\r\n\t\t\t\t\t\t\t\tres: file.result,\r\n\t\t\t\t\t\t\t\tuuid: request.uuid,\r\n\t\t\t\t\t\t\t\tsuccess: true\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\tsendFetchDataToContentScript(dist, 'receiveHttpRequest');\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t\tfile.readAsDataURL(blob);\r\n\t\t\t\t\t}\r\n\t\t\t\t} else {\r\n\t\t\t\t\tvar dist = {\r\n\t\t\t\t\t\turl: request.url,\r\n\t\t\t\t\t\tres: '',\r\n\t\t\t\t\t\tuuid: request.uuid,\r\n\t\t\t\t\t\tsuccess: false\r\n\t\t\t\t\t}\r\n\t\t\t\t\tsendFetchDataToContentScript(dist, 'receiveHttpRequest');\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\t\txhr.send(null);\r\n\t\tsendResponse();\r\n\t} else if (request.cmd == 'sendDownload') { // 下载文件\r\n\t\tvar dlData = [];\r\n\t\tchrome.downloads.download(\r\n\t\t\t{\r\n\t\t\t  url: request.url,\r\n\t\t\t  filename: request.fileName,\r\n\t\t\t  conflictAction: 'overwrite',\r\n\t\t\t  saveAs: false,\r\n\t\t\t},\r\n\t\t\tfunction (id) {\r\n\t\t\t  // id 是 Chrome 新建立的下载任务的 id\r\n\t\t\t  dlData[id] = {\r\n\t\t\t\turl: request.url,\r\n\t\t\t\tid: request.id,\r\n\t\t\t\tuuid: false,\r\n\t\t\t  }\r\n\t\t\t}\r\n\t\t  )\r\n\t}\r\n});\r\n\r\n// 将跨域获取的数据传回到content-script, content-script 再传到宿主页面 \r\nfunction sendFetchDataToContentScript(data, cmd) {\r\n\tchrome.tabs.query({}, function(tabs){\r\n\t\ttabs.forEach(function(tab, index) {\r\n\t\t\tif(tab.url.indexOf('danbooru') > -1 || tab.url.indexOf('yande.re') > -1  ||tab.url.indexOf('localhost') > -1 || tab.url.indexOf('wonbao') > -1 || tab.url.indexOf('file:') > -1 || tab.url.indexOf('192.168') > -1) {\r\n\t\t\t\tchrome.tabs.sendMessage(\r\n\t\t\t\t\ttabs[index].id, \r\n\t\t\t\t\t{\r\n\t\t\t\t\t\tindex: index,\r\n\t\t\t\t\t\tcmd: cmd,\r\n\t\t\t\t\t\turl: data.url,\r\n\t\t\t\t\t\tres: data.res,\r\n\t\t\t\t\t\tuuid: data.uuid\r\n\t\t\t\t\t},\r\n\t\t\t\t\tfunction(response) {\r\n\t\t\t\t})\r\n\t\t\t}\r\n\t\t})\r\n\t})\r\n}\r\n\r\n\r\n$('#test_cors').click(function(e) {\r\n\t/* $.get('https://www.baidu.com', function(html){\r\n\t\tconsole.log( html);\r\n\t\talert('跨域调用成功！');\r\n\t}); */\r\n\t// var url = 'https://detail.1688.com/offer/577545270423.html';\r\n\tvar url = 'https://ai.taobao.com/search/index.htm?source_id=search&key=%E5%90%95';\r\n\t$.ajax({\r\n\t\ttype: \"GET\",\r\n\t\turl: url,\r\n\t\ttimeout: 10000000,\r\n\t\tasync: false,\r\n\t\tdata: {},\r\n\t\tdataType: \"json\",\r\n\t\tsuccess: function(data){\r\n\t\t\tconsole.log('success');\r\n\t\t\tconsole.log(data);\r\n\t\t},\r\n\t\terror: function(data) {\r\n\t\t\tconsole.log('error');\r\n\t\t\tconsole.log(data);\r\n\t\t}\r\n\t});\r\n});\r\n\r\n$('#get_popup_title').click(function (e) {\r\n\tvar views = chrome.extension.getViews({type:'popup'});\r\n\tif(views.length > 0) {\r\n\t\talert(views[0].document.title);\r\n\t} else {\r\n\t\talert('popup未打开！');\r\n\t}\r\n});\r\n\r\n// 获取当前选项卡ID\r\nfunction getCurrentTabId(callback)\r\n{\r\n\tchrome.tabs.query({active: true, currentWindow: true}, function(tabs)\r\n\t{\r\n\t\tif(callback) callback(tabs.length ? tabs[0].id: null);\r\n\t});\r\n}\r\n\r\n// 当前标签打开某个链接\r\nfunction openUrlCurrentTab(url)\r\n{\r\n\tgetCurrentTabId(function(tabId) {\r\n\t\tchrome.tabs.update(tabId, {url: url});\r\n\t})\r\n}\r\n\r\n// 新标签打开某个链接\r\nfunction openUrlNewTab(url)\r\n{\r\n\tchrome.tabs.create({url: url});\r\n}\r\n\r\n// 预留一个方法给popup调用\r\nfunction testBackground() {\r\n\talert('你好，我是background！');\r\n}\r\n\r\n/* \r\n// 是否显示图片\r\nvar showImage;\r\nchrome.storage.sync.get({showImage: true}, function(items) {\r\n\tshowImage = items.showImage;\r\n});\r\n\r\n// web请求监听，最后一个参数表示阻塞式，需单独声明权限：webRequestBlocking\r\nchrome.webRequest.onBeforeRequest.addListener(function (details) {\r\n\t// cancel 表示取消本次请求\r\n\tif(!showImage && details.type == 'image') return {cancel: true};\r\n\t// 简单的音视频检测\r\n\t// 大部分网站视频的type并不是media，且视频做了防下载处理，所以这里仅仅是为了演示效果，无实际意义\r\n\tif(details.type == 'media') {\r\n\t\tchrome.notifications.create(null, {\r\n\t\t\ttype: 'basic',\r\n\t\t\ticonUrl: 'img/icon.png',\r\n\t\t\ttitle: '检测到音视频',\r\n\t\t\tmessage: '音视频地址：' + details.url,\r\n\t\t});\r\n\t}\r\n}, {urls: [\"<all_urls>\"]}, [\"blocking\"]); */\n\n\n// WEBPACK FOOTER //\n// ./src/background.js"],"sourceRoot":""}